<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø°Ù Ø·Ø§Ù„Ø¨</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="form-container">
        <h1>ğŸ—‘ï¸ Ø­Ø°Ù Ø·Ø§Ù„Ø¨</h1>
        
        <fieldset>
            <legend>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</legend>
            <form id="selectGroupForm">
                <table class="form-table">
                    <tr>
                        <td>
                            <label for="groupe">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© <span class="required">*</span></label>
                            <select name="groupe" id="groupe" required>
                                <option value="">-- Ø§Ø®ØªØ± Ù…Ø¬Ù…ÙˆØ¹Ø© --</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="submit" value="âœ“ Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨">
                        </td>
                    </tr>
                </table>
            </form>
        </fieldset>
        
        <div id="studentsList"></div>
        
        <div class="text-center mt-3">
            <a href="choix.html" class="btn btn-secondary">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</a>
        </div>
    </div>
    
    <script src="js/db.js"></script>
    <script src="js/app.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', async () => {
            await kayel.loadGroups('groupe');
        });
        
        document.getElementById('selectGroupForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const groupId = document.getElementById('groupe').value;
            if (!groupId) {
                kayel.showErrorMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¬Ù…ÙˆØ¹Ø©');
                return;
            }
            
            try {
                const students = await db.getStudentsByGroup(parseInt(groupId));
                const group = await db.getGroup(parseInt(groupId));
                
                if (students.length === 0) {
                    document.getElementById('studentsList').innerHTML = `
                        <div class='error-message'>âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</div>
                    `;
                    return;
                }
                
                document.getElementById('studentsList').innerHTML = `
                    <h3 style='color: var(--primary); text-align: center; margin: 1.5rem 0;'>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©: ${group.name}</h3>
                    <form id="deleteForm">
                        <table style='width: 100%;'>
                            <thead>
                                <tr>
                                    <th>Ø­Ø°Ù</th>
                                    <th>Ø§Ù„Ø­ØµØ©</th>
                                    <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${students.map(s => `
                                    <tr>
                                        <td style='text-align: center;'>
                                            <input type='checkbox' name='student_${s.id}' value='${s.id}' style='width: 24px; height: 24px;'>
                                        </td>
                                        <td style='text-align: center;'>${s.seance}</td>
                                        <td>${s.name}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        <div class='text-center mt-3'>
                            <input type='submit' value='ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯' style='background: var(--gradient-danger);'>
                        </div>
                    </form>
                `;
                
                document.getElementById('deleteForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const success = await kayel.deleteSelectedStudents(groupId);
                    if (success) {
                        document.getElementById('selectGroupForm').dispatchEvent(new Event('submit'));
                    }
                });
                
            } catch (error) {
                kayel.showErrorMessage('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨');
                console.error(error);
            }
        });
    </script>
</body>
</html>
